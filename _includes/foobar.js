// Generated by CoffeeScript 1.4.0
(function() {
  var MyGovLoader,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  MyGovLoader = (function() {

    MyGovLoader.prototype.rootUrl = 'http://gsa-ocsit.github.com/';

    MyGovLoader.prototype.scrollTrigger = 80;

    MyGovLoader.prototype.loaded = false;

    MyGovLoader.prototype.state = 'hidden';

    MyGovLoader.prototype.id = 'myGovBar';

    MyGovLoader.prototype.style = {
      position: 'fixed',
      bottom: 0,
      left: 0,
      background: 'transparent',
      width: '100%',
      height: '110px',
      border: 0,
      'z-index': 9999999,
      overflow: 'hidden'
    };

    function MyGovLoader() {
      this.onScroll = __bind(this.onScroll, this);
      this.addEvent(document, 'scroll', this.onScroll);
    }

    MyGovLoader.prototype.addEvent = function(el, event, func) {
      if (el.addEventListener) {
        return el.addEventListener(event, func, false);
      } else if (el.attachEvent) {
        return el.attachEvent("on" + event, func);
      }
    };

    MyGovLoader.prototype.onScroll = function() {
      if (this.offsetBottom() > this.scrollTrigger) {
        return this.show();
      } else {
        return this.hide();
      }
    };

    MyGovLoader.prototype.positionTop = function() {
      return window.pageYOffset || body.scrollTop || html.scrollTop;
    };

    MyGovLoader.prototype.pageHeight = function() {
      return Math.max(Math.max(document.body.scrollHeight, document.documentElement.scrollHeight), Math.max(document.body.offsetHeight, document.documentElement.offsetHeight), Math.max(document.body.clientHeight, document.documentElement.clientHeight));
    };

    MyGovLoader.prototype.windowHeight = function() {
      return window.innerHeight || html.clientHeight || body.clientHeight || screen.availHeight;
    };

    MyGovLoader.prototype.offsetBottom = function() {
      return 100 * (this.positionTop() + this.windowHeight()) / this.pageHeight();
    };

    MyGovLoader.prototype.load = function() {
      var el, key, value, _ref;
      el = document.createElement('iframe');
      el.name = this.id;
      el.id = this.id;
      el.src = this.rootUrl + 'mygov-bar/mygov-bar.html#' + encodeURIComponent(document.location.href);
      _ref = this.style;
      for (key in _ref) {
        value = _ref[key];
        el.style[key] = value;
      }
      document.body.appendChild(el);
      XD.receiveMessage(this.recieve, this.rootUrl.replace(/\/$/, ''));
      return this.loaded = true;
    };

    MyGovLoader.prototype.setWidth = function(width) {
      return document.getElementById(this.id).style.width = width;
    };

    MyGovLoader.prototype.show = function() {
      if (this.state === 'shown') {
        return;
      }
      if (!this.loaded) {
        this.load();
      }
      this.setWidth('100%');
      this.state = 'shown';
      return this.send(this.state);
    };

    MyGovLoader.prototype.hide = function() {
      if (this.state === 'hidden') {
        return;
      }
      this.setWidth('0px');
      this.state = 'hidden';
      return this.send(this.state);
    };

    MyGovLoader.prototype.send = function(msg) {
      var iframe;
      iframe = document.getElementById(this.id);
      return XD.postMessage(msg, iframe.src, frames.myGovBar);
    };

    MyGovLoader.prototype.recieve = function(msg) {
      return alert(msg.data);
    };

    return MyGovLoader;

  })();

  window.MyGovLoader = new MyGovLoader();

}).call(this);
