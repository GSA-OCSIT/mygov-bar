// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},s=function(e,t){return function(){return e.apply(t,arguments)}};MyGovBar.Models.Page=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.paramRoot="page",t.prototype.urlRoot=MyGovBar.config.api_url+"/pages",t.prototype.url=function(){var e;return e=this.urlRoot,this.id!=null&&(e+="/"+this.id),e+=".json?callback=?",e},t.prototype.lookup=function(){var e,t=this;return e=this.url,this.url=this.urlRoot+"/lookup.json?url="+this.get("url")+"&callback=?",this.fetch({error:function(e,n){if(n.status!==404)return;return t.save()}}),this.url=e,this.trigger("change")},t.prototype.initialize=function(){return this.lookup()},t.prototype.defaults={url:document.referrer},t.prototype.get_meta_keywords=function(){return $("meta[name] ").filter(function(){return this.name.toLowerCase()==="keywords"}).attr("content")},t}(Backbone.Model),MyGovBar.Collections.PagesCollection=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.model=MyGovBar.Models.Page,t.prototype.url="/pages",t}(Backbone.Collection),MyGovBar.Views.Mini=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.el="#bar",t.prototype.events={"click #toggle":"toggle"},t.prototype.render=function(){var e;return this.$el.addClass("mini"),this.$el.removeClass("expanded"),e=new MyGovBar.Views.Related({model:this.model})},t.prototype.toggle=function(){return MyGovBar.router.navigate("expanded",!0)},t}(Backbone.View),MyGovBar.Views.Related=function(e){function t(){return this.render=s(this.render,this),t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.el="#drawer",t.prototype.template=$("#related_template").html(),t.prototype.render=function(){var e;return console.log("RENDERING RELATED"),console.log(this.template),e=_.template(this.template),this.$el.html(e(this.model.toJSON()))},t.prototype.initialize=function(){return this.model.on("change",this.render)},t}(Backbone.View),t={interval_id:void 0,last_hash:void 0,cache_bust:1,attached_callback:void 0,window:this,postMessage:function(e,t,n){if(!t)return;n=n||parent;if(window.postMessage)return n.postMessage(e,t.replace(/([^:]+:\/\/[^\/]+).*/,"$1"));if(t)return n.location=t.replace(/#.*$/,"")+"#"+ +(new Date)+cache_bust++ +"&"+e},receiveMessage:function(e,t){var n,r;if(window.postMessage)return e&&(n=function(n){return typeof t=="string"&&n.origin!==t||Object.prototype.toString.call(t)==="[object Function]"&&t(n.origin)===!1?(console.log("cross iframe request blocked. Domains "+n.origin+" and "+t+" must match."),!1):e(n)}),window.addEventListener?window[e?"addEventListener":"removeEventListener"]("message",n,!1):window[e?"attachEvent":"detachEvent"]("onmessage",n);r&&clearInterval(r),r=null;if(e)return r=setInterval(function(){var t,n,r;t=document.location.hash,r=/^#?\d+&/;if(t!==n&&r.test(t))return n=t,e({data:t.replace(r,"")})},100)}},e=function(){function e(){this.send=s(this.send,this),this.recieve=s(this.recieve,this),this.parent_url=decodeURIComponent(document.location.hash.replace(/^#/,"")).match(/([^:]+:\/\/.[^/]+)/)[1],t.receiveMessage(this.recieve,this.parent_url)}return e.prototype.recieve=function(e){switch(e.data){case"shown":case"hidden":return this.toggleVisibility()}},e.prototype.send=function(e){return t.postMessage(e,this.parent_url)},e.prototype.toggleVisibility=function(){return MyGovBar.el.toggleClass("hidden"),MyGovBar.el.toggleClass("shown")},e}(),MyGovBar.CrossDomain=new e,n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.routes={expand:"expand",related:"related",tags:"tags",search:"search",feedback:"feedback","*path":"mini"},t.prototype.mini=function(){var e,t;return t=new MyGovBar.Models.Page,e=new MyGovBar.Views.Mini({model:t}),e.render()},t.prototype.expand=function(){},t}(Backbone.Router),MyGovBar.Router=new n}).call(this);