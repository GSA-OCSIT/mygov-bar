(function(){var t,e,r,o={}.hasOwnProperty,n=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a=function(t,e){return function(){return t.apply(e,arguments)}};r={interval_id:void 0,last_hash:void 0,cache_bust:1,attached_callback:void 0,window:this,postMessage:function(t,e,r){return e?(r=r||parent,window.postMessage?r.postMessage(t,e.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):e?r.location=e.replace(/#.*$/,"")+"#"+ +new Date+cache_bust++ +"&"+t:void 0):void 0},receiveMessage:function(t,e){var r,o;return window.postMessage?(t&&(r=function(r){return"string"==typeof e&&r.origin!==e||"[object Function]"===Object.prototype.toString.call(e)&&e(r.origin)===!1?!1:t(r)}),window.addEventListener?window[t?"addEventListener":"removeEventListener"]("message",r,!1):window[t?"attachEvent":"detachEvent"]("onmessage",r)):(o&&clearInterval(o),o=null,t?o=setInterval(function(){var e,r,o;return e=document.location.hash,o=/^#?\d+&/,e!==r&&o.test(e)?(r=e,t({data:e.replace(o,"")})):void 0},100):void 0)}},MyGovBar.Models.Comment=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.url=function(){return MyGovBar.config.api_url+"/pages/"+this.get("page_id")+"/comments.json"},e.prototype.defaults=function(){return{page_id:MyGovBar.page.get("id"),body:""}},e}(Backbone.Model),MyGovBar.Collections.Comments=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.model=MyGovBar.Models.Comment,e}(Backbone.Collection),MyGovBar.Models.Page=function(t){function e(){return this.poll=a(this.poll,this),this.lookup=a(this.lookup,this),e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.paramRoot="page",e.prototype.urlRoot=MyGovBar.config.api_url+"/pages",e.prototype.poller=null,e.prototype.url=function(){var t;return t=this.urlRoot,null!=this.id&&(t+="/"+this.id),t+=".json"},e.prototype.lookup=function(){var t,e=this;return t=this.url,this.url=this.urlRoot+".json?url="+this.get("url")+"&callback=?",this.fetch({success:function(){return e.initPolling()}}),this.url=t},e.prototype.initialize=function(){return this.set("tags",new MyGovBar.Collections.Tags),this.lookup(),this.on("change:related",this.renderRelated),this.on("change:tag_list",this.renderTags)},e.prototype.defaults={url:document.referrer,related:[],tag_list:""},e.prototype.parse=function(t){var e;if(null!=t)return e=new MyGovBar.Collections.Tags,_.each(t.tags,function(t){return e.add(new MyGovBar.Models.Tag(t),{silent:!0})}),t.tags=e,t},e.prototype.hasRelated=function(){return this.get("related").length===!0},e.prototype.initPolling=function(){return this.hasRelated()?void 0:this.poller=setInterval(this.poll,5e3)},e.prototype.stopPolling=function(){return clearInterval(this.poller),this.poller={}},e.prototype.poll=function(){var t=this;return this.fetch({success:function(){return t.hasRelated()?(t.stopPolling(),t.maybeRender()):void 0}})},e.prototype.renderRelated=function(){return"related"===Backbone.history.fragment?MyGovBar.router.navigate("related",!0):void 0},e.prototype.renderTags=function(){return"tags"===Backbone.history.fragment?MyGovBar.router.navigate("related",!0):void 0},e}(Backbone.Model),MyGovBar.Collections.PagesCollection=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.model=MyGovBar.Models.Page,e.prototype.url="/pages",e}(Backbone.Collection),MyGovBar.Models.SearchResult=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(Backbone.Model),MyGovBar.Collections.SearchResults=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.model=MyGovBar.Models.SearchResult,e.prototype.url=function(){var t;return t="http://search.usa.gov/api/search.json?",t+="&affiliate="+MyGovBar.config.search_affiliate,t+="&query="+this.query,t+="&callback=?"},e.prototype.parse=function(t){var e=this;return _.each(t.results,function(t){var r,o,n,a,i;for(a=["title","content"],i=[],o=0,n=a.length;n>o;o++)r=a[o],i.push(t[r]=e.htmlHighlight(t[r]));return i}),t.results},e.prototype.initialize=function(t){return null!=t.query?this.query=t.query:void 0},e.prototype.htmlHighlight=function(t){return t.replace(/\ue000/g,'<span class="highlight">').replace(/\ue001/g,"</span>")},e}(Backbone.Collection),MyGovBar.Models.Tag=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.url=function(){return MyGovBar.config.api_url+"/tags"+this.get("name")+".json"},e.prototype.defaults={name:"",id:null},e}(Backbone.Model),MyGovBar.Collections.Tags=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.model=MyGovBar.Models.Tag,e.prototype.url=MyGovBar.config.api_url+"/tags",e.prototype.toJSON=function(){return this.pluck("name").join(", ")},e.prototype.initialize=function(){var t=this;return this.on("add remove",function(){return MyGovBar.page.save({tag_list:t.toJSON()})})},e}(Backbone.Collection),MyGovBar.Views.Expanded=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#bar",e.prototype.events={"click #tabs li.tags a":"tags","click #tabs li.search a":"search","click #tabs li.feedback a":"feedback"},e.prototype.render=function(){var t=this;return this.$el.clearQueue(),this.$el.css("width",this.$el.css("width")),setTimeout(function(){return t.$el.animate({left:"0px",width:"100%"},MyGovBar.config.animation_speed,"swing",function(){return t.$el.removeClass("mini"),t.$el.addClass("shown"),t.$el.addClass("expanded"),t.$el.removeClass("hidden"),MyGovBar.CrossDomain.sendHeight(),t.trigger("render")})},1)},e.prototype.tags=function(t){return MyGovBar.router.go("tags",t)},e.prototype.search=function(t){return MyGovBar.router.go("search",t)},e.prototype.feedback=function(t){return MyGovBar.router.go("feedback",t)},e}(Backbone.View),MyGovBar.Views.Feedback=function(t){function e(){return this.submitComment=a(this.submitComment,this),this.saveRating=a(this.saveRating,this),e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#drawer",e.prototype.saveOnChange=!1,e.prototype.events={"submit #feedback":"submitComment"},e.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.$el.html(MyGovBar.Templates.feedback()),this.initStars()},e.prototype.saveRating=function(t){return this.saveOnChange?this.model.save({rating:t}):void 0},e.prototype.submitComment=function(t){var e,r;return r=$("#comment"),t.preventDefault(),e=new MyGovBar.Models.Comment({page_id:this.model.get("id")}),e.on("sync",this.commentSuccess),e.save({body:r.val()}),r.val(""),!1},e.prototype.commentSuccess=function(){return $("#comment_submitted").fadeIn().delay(5e3).fadeOut()},e.prototype.initStars=function(){var t;return t=$("input.star"),t.rating({callback:this.saveRating}),t.rating("select",Math.round(parseFloat(this.model.get("avg_rating")))-1),this.saveOnChange=!0},e}(Backbone.View),MyGovBar.Views.Hidden=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#bar",e.prototype.render=function(){var t=this;return $(".row").css("width",window.innerWidth+"px"),this.$el.animate({left:"-100%"},MyGovBar.config.animation_speed,"swing",function(){return t.reset()})},e.prototype.reset=function(){return this.$el.removeClass("shown"),this.$el.addClass("hidden"),this.$el.removeClass("mini"),this.$el.removeClass("expanded"),this.$el.clearQueue(),$(".row").css("width","100%"),this.$el.css("left","-100%")},e}(Backbone.View),MyGovBar.Views.Mini=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#bar",e.prototype.events={"click .expand a":"toggle","click #tabs li.related a":"related","click #close-bar":"close","click .less":"minify"},e.prototype.render=function(){var t=this;return this.$el.clearQueue(),this.$el.addClass("mini"),this.$el.addClass("shown"),this.$el.removeClass("expanded"),this.$el.removeClass("hidden"),$(".row").css("width",window.innerWidth+"px"),setTimeout(function(){return t.$el.animate({left:"0px",width:"100%"},MyGovBar.config.animation_speed,"swing",function(){return $(".row").css("width","100%"),t.related()})},1)},e.prototype.toggle=function(t){return MyGovBar.router.go("expanded",t),this.related()},e.prototype.related=function(t){return MyGovBar.router.go("related",t)},e.prototype.close=function(t){return MyGovBar.router.go("hidden",t)},e.prototype.minify=function(t){return MyGovBar.router.go("mini",t)},e}(Backbone.View),MyGovBar.Views.Related=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#drawer",e.prototype.template=$("#related_template").html(),e.prototype["class"]="related",e.prototype.render=function(){return this.model.hasRelated()?this.$el.html(MyGovBar.Templates.related(this.model.toJSON())):this.$el.html(MyGovBar.Templates.loading_related()),MyGovBar.CrossDomain.sendHeight(),this},e}(Backbone.View),MyGovBar.Views.Search=function(t){function e(){return this.submit=a(this.submit,this),e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#drawer",e.prototype.template=$("#search_template").html(),e.prototype.events={"submit #search":"submit"},e.prototype.render=function(){return this.$el.html(MyGovBar.Templates.search())},e.prototype.submit=function(t){return MyGovBar.router.go("search/"+$("#search_query").val(),t)},e}(Backbone.View),MyGovBar.Views.SearchResult=function(t){function e(){return this.render=a(this.render,this),e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#drawer",e.prototype.template=$("#search_result_template").html(),e.prototype.initialize=function(){return this.collection.on("reset",this.render)},e.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.$el.html(MyGovBar.Templates.search_result({query:this.collection.query,results:this.collection.toJSON().splice(0,3)})),MyGovBar.CrossDomain.sendHeight()},e}(Backbone.View),MyGovBar.TagManager=function(){function t(){}return t.prototype.compareItems=function(t,e){return t.get("name")===e.get("name")?!0:!1},t.prototype.init=function(){},t.prototype.filter=function(t,e){return _.filter(t.models,function(t){return this.itemContains(t,e)})},t.prototype.itemContains=function(t){return 0===t.get("name").indexOf(query)},t.prototype.itemToString=function(t){return t.get("name")},t.prototype.stringToItem=function(t){var e;return e=new MyGovBar.Models.Tag,e.set("name",t),e},t}(),MyGovBar.Views.Tags=function(t){function e(){return this.render=a(this.render,this),e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.el="#drawer",e.prototype.template=$("#tags_template").html(),e.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.$el.html(MyGovBar.Templates.tags({page:this.model.toJSON(),tags:this.model.get("tags").toJSON()})),$("#tag_list").textext({plugins:"tags autocomplete suggestsions ajax",tagsItems:this.model.get("tags").models,itemManager:MyGovBar.TagManager,ajax:{url:MyGovBar.config.api_url+"/tags.json"}}),$("#tag_list").unbind("setSuggestions"),$("#tag_list").on({setSuggestions:function(t,e){var r;return r=[],_.each(e.result,function(t){return r.push(new MyGovBar.Models.Tag(t))}),e.result=r,$("#tag_list").textext()[0].autocomplete().onSetSuggestions(t,e)}}),$("#tag_list").on("setFormData",function(t,e){return MyGovBar.page.get("tags").update(e)})},e}(Backbone.View),t=function(){function t(){this.sendHeight=a(this.sendHeight,this),this.send=a(this.send,this),this.recieve=a(this.recieve,this);var t,e,o;e=$.deparam.fragment(!0);for(t in e)o=e[t],this.setConfig(t,o);r.receiveMessage(this.recieve,MyGovBar.config.parent_url),Backbone.history.on("route",this.sendHeight)}return t.prototype.bar=$("#bar"),t.prototype.hash=document.location.hash,t.prototype.allowed_params=["tabs","url"],t.prototype.recieve=function(t){return MyGovBar.router.navigate(t.data,!0)},t.prototype.send=function(t){return r.postMessage(t,MyGovBar.config.parent_url)},t.prototype.sendHeight=function(){return this.send("height-"+this.bar.height()+"px")},t.prototype.setConfig=function(t,e){return-1!==_.indexOf(this.allowed_params,t)?("url"===t&&(t="parent_url"),MyGovBar.config[t]=e):void 0},t}(),MyGovBar.CrossDomain=new t,e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.routes={hidden:"hide",expanded:"expand",related:"related",tags:"tags",search:"search","search/:query":"searchResult",feedback:"feedback",mini:"mini","*path":"minify"},e.prototype.initialize=function(){return MyGovBar.page=new MyGovBar.Models.Page,Backbone.history.on("route",this.setCurrent),window.onbeforeunload=function(){sessionStorage.myGovBarExpanded="mini"!==Backbone.history.fragment&&"hidden"!==Backbone.history.fragment}},e.prototype.mini=function(){return MyGovBar.CrossDomain.send("mini"),new MyGovBar.Views.Mini({model:MyGovBar.page}).render()},e.prototype.minify=function(){return this.navigate("mini",!0)},e.prototype.expand=function(){return MyGovBar.CrossDomain.send("expanded"),(new MyGovBar.Views.Expanded).render(),this.setCurrent()},e.prototype.hide=function(){return MyGovBar.CrossDomain.send("hidden"),(new MyGovBar.Views.Hidden).render()},e.prototype.tags=function(){return new MyGovBar.Views.Tags({model:MyGovBar.page}).render()},e.prototype.related=function(){return new MyGovBar.Views.Related({model:MyGovBar.page}).render()},e.prototype.search=function(){return(new MyGovBar.Views.Search).render()},e.prototype.searchResult=function(t){var e;return e=new MyGovBar.Collections.SearchResults({query:t}),e.fetch(),new MyGovBar.Views.SearchResult({collection:e})},e.prototype.feedback=function(){return new MyGovBar.Views.Feedback({model:MyGovBar.page}).render()},e.prototype.setCurrent=function(){var t;return t=Backbone.history.fragment,-1!==t.indexOf("search/")&&(t="search search-result"),$("#tabs li.current").removeClass("current"),$("#tabs li."+t).addClass("current"),$("#bar").removeClass(MyGovBar.config.tabs.join(" ")+" search-result"),$("#bar").addClass(t)},e.prototype.go=function(t,e){return null!=e&&e.preventDefault(),this.navigate(t,!0),!1},e}(Backbone.Router),MyGovBar.router=new e,_.each(MyGovBar.config.tabs,function(t){return $("#tabs ."+t).addClass("activated")}),Backbone.history.start(),null!=sessionStorage.myGovBarExpanded&&"true"===sessionStorage.myGovBarExpanded&&MyGovBar.router.navigate("expanded",!0)}).call(this);