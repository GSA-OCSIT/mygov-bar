!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v={}.hasOwnProperty,w=function(a,b){function c(){this.constructor=a}for(var d in b)v.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},x=function(a,b){return function(){return a.apply(b,arguments)}};c={interval_id:void 0,last_hash:void 0,cache_bust:1,attached_callback:void 0,window:this,postMessage:function(a,b,c){return b?(c=c||parent,window.postMessage?c.postMessage(a,b.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):b?c.location=b.replace(/#.*$/,"")+"#"+ +new Date+cache_bust++ +"&"+a:void 0):void 0},receiveMessage:function(a,b){var c,d;return window.postMessage?(a&&(c=function(c){return"string"==typeof b&&c.origin!==b||"[object Function]"===Object.prototype.toString.call(b)&&b(c.origin)===!1?!1:a(c)}),window.addEventListener?window[a?"addEventListener":"removeEventListener"]("message",c,!1):window[a?"attachEvent":"detachEvent"]("onmessage",c)):(d&&clearInterval(d),d=null,a?d=setInterval(function(){var b,c,d;return b=document.location.hash,d=/^#?\d+&/,b!==c&&d.test(b)?(c=b,a({data:b.replace(d,"")})):void 0},100):void 0)}},MyGovBar.Models.Comment=function(a){function b(){return d=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.url=function(){return MyGovBar.config.api_url+"/pages/"+this.get("page_id")+"/comments.json"},b.prototype.defaults=function(){return{page_id:MyGovBar.page.get("id"),body:""}},b}(Backbone.Model),MyGovBar.Collections.Comments=function(a){function b(){return e=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.model=MyGovBar.Models.Comment,b}(Backbone.Collection),MyGovBar.Models.Page=function(a){function b(){return this.poll=x(this.poll,this),this.hasRelated=x(this.hasRelated,this),this.getSourceUrl=x(this.getSourceUrl,this),this.lookup=x(this.lookup,this),n=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.paramRoot="page",b.prototype.urlRoot=MyGovBar.config.api_url+"/pages",b.prototype.poller=null,b.prototype.url=function(){var a;return a=this.urlRoot,null!=this.id&&(a+="/"+this.id),a+=".json"},b.prototype.lookup=function(){var a,b=this;return a=this.url,this.url=this.urlRoot+(".json?url="+this.getSourceUrl())+"&callback=?",this.fetch({success:function(){return b.initPolling()}}),this.url=a},b.prototype.getSourceUrl=function(){var a;return a=MyGovBar.config.development_source_url||this.get("url")},b.prototype.initialize=function(){return this.set("tags",new MyGovBar.Collections.Tags),this.lookup(),this.on("change:related",this.renderRelated()),this.on("change:tag_list",this.renderTags())},b.prototype.defaults={url:document.referrer,related:[],tag_list:""},b.prototype.parse=function(a){var b;if(null!=a)return b=new MyGovBar.Collections.Tags,_.each(a.tags,function(a){return b.add(new MyGovBar.Models.Tag(a),{silent:!0})}),a.tags=b,a},b.prototype.hasRelated=function(){return this.get("related").length>0},b.prototype.initPolling=function(){return this.hasRelated()?void 0:this.poller=setInterval(this.poll,5e3)},b.prototype.stopPolling=function(){return clearInterval(this.poller),this.poller={}},b.prototype.poll=function(){var a=this;return this.fetch({success:function(){return a.hasRelated()?(a.stopPolling(),a.maybeRender()):void 0}})},b.prototype.renderRelated=function(){return"related"===Backbone.history.fragment?new MyGovBar.Views.Related({model:MyGovBar.page}).render():void 0},b.prototype.renderTags=function(){return"tags"===Backbone.history.fragment?new MyGovBar.Views.Tags({model:MyGovBar.page}).render():void 0},b}(Backbone.Model),MyGovBar.Collections.PagesCollection=function(a){function b(){return o=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.model=MyGovBar.Models.Page,b.prototype.url="/pages",b}(Backbone.Collection),MyGovBar.Models.Rating=function(a){function b(){return p=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.url=function(){return MyGovBar.config.api_url+"/pages/"+this.get("page_id")+"/ratings.json"},b.prototype.defaults=function(){return{page_id:MyGovBar.page.get("id"),value:0}},b}(Backbone.Model),MyGovBar.Models.SearchResult=function(a){function b(){return q=b.__super__.constructor.apply(this,arguments)}return w(b,a),b}(Backbone.Model),MyGovBar.Collections.SearchResults=function(a){function b(){return r=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.model=MyGovBar.Models.SearchResult,b.prototype.url=function(){var a;return a="https://search.usa.gov/api/search.json?",a+="affiliate="+MyGovBar.config.search_affiliate,a+="&query="+this.query,a+="&callback=?"},b.prototype.parse=function(a){var b=this;return _.each(a.results,function(a){var c,d,e,f,g;for(f=["title","content"],g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(a[c]=b.htmlHighlight(a[c]));return g}),a.results},b.prototype.initialize=function(a){return null!=a.query?this.query=a.query:void 0},b.prototype.htmlHighlight=function(a){return a.replace(/\ue000/g,'<span class="highlight">').replace(/\ue001/g,"</span>")},b}(Backbone.Collection),MyGovBar.Models.Tag=function(a){function b(){return s=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.url=function(){return MyGovBar.config.api_url+"/tags"+this.get("name")+".json"},b.prototype.defaults={name:"",id:null},b}(Backbone.Model),MyGovBar.Collections.Tags=function(a){function b(){return t=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.model=MyGovBar.Models.Tag,b.prototype.url=MyGovBar.config.api_url+"/tags",b.prototype.toJSON=function(){return this.pluck("name").join(", ")},b.prototype.initialize=function(){var a=this;return this.on("add remove",function(){return MyGovBar.page.save({tag_list:a.toJSON()})})},b}(Backbone.Collection),MyGovBar.Views.Collapsed=function(a){function b(){return u=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.el="#bar",b.prototype.events={"click #tabs li.related a":"related","click #tabs li.tags a":"tags","click #tabs li.search a":"search","click #tabs li.feedback a":"feedback","click li.hide a":"hide"},b.prototype.render=function(){return $("#tabs .icon").removeClass("activated"),this.$el.clearQueue(),this.$el.css("width","100%"),this.$el.addClass("shown"),this.$el.addClass("collapsed"),this.$el.removeClass("expanded"),this.$el.removeClass("hidden"),MyGovBar.CrossDomain.sendHeight(),this.trigger("render")},b.prototype.related=function(a){return MyGovBar.router.go("related",a)},b.prototype.tags=function(a){return MyGovBar.router.go("tags",a)},b.prototype.search=function(a){return MyGovBar.router.go("search",a)},b.prototype.feedback=function(a){return MyGovBar.router.go("feedback",a)},b.prototype.hide=function(a){return MyGovBar.router.go("hidden",a)},b}(Backbone.View),MyGovBar.Views.Expanded=function(a){function b(){return f=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.render=function(){return $("#tabs .icon").removeClass("activated"),this.$el.clearQueue(),this.$el.css("width","100%"),this.$el.addClass("shown"),this.$el.addClass("expanded"),this.$el.removeClass("collapsed"),this.$el.removeClass("hidden"),MyGovBar.CrossDomain.sendHeight(),this.trigger("render")},b}(MyGovBar.Views.Collapsed),MyGovBar.Views.Feedback=function(a){function b(){return this.submitComment=x(this.submitComment,this),this.saveRating=x(this.saveRating,this),g=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.el="#drawer",b.prototype.events={"submit #feedback":"submitComment"},b.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.$el.html(MyGovBar.Templates.feedback()),this.$("#stars").raty({width:"200px",click:this.saveRating})},b.prototype.saveRating=function(a){var b;return b=new MyGovBar.Models.Rating({page_id:this.model.get("id")}),b.save({value:a})},b.prototype.submitComment=function(a){var b,c;return c=$("#comment"),a.preventDefault(),b=new MyGovBar.Models.Comment({page_id:this.model.get("id")}),b.on("sync",this.commentSuccess),b.save({body:c.val()}),c.val(""),!1},b.prototype.commentSuccess=function(){return $("#comment_submitted").fadeIn().delay(5e3).fadeOut()},b}(Backbone.View),MyGovBar.Views.Hidden=function(a){function b(){return h=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.render=function(){return $("#tabs .icon").addClass("activated"),this.$el.clearQueue(),this.$el.css("width",MyGovBar.config.width_minimized),this.$el.addClass("hidden"),this.$el.removeClass("expanded"),this.$el.removeClass("collapsed"),MyGovBar.CrossDomain.sendHeight()},b}(MyGovBar.Views.Collapsed),MyGovBar.Views.Related=function(a){function b(){return i=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.el="#drawer",b.prototype.template=$("#related_template").html(),b.prototype["class"]="related",b.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.model.hasRelated()?this.$el.html(MyGovBar.Templates.related(this.model.toJSON())):this.$el.html(MyGovBar.Templates.loading_related()),MyGovBar.CrossDomain.sendHeight(),this},b}(Backbone.View),MyGovBar.Views.Search=function(a){function b(){return this.submit=x(this.submit,this),j=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.el="#drawer",b.prototype.template=$("#search_template").html(),b.prototype.events={"submit #search":"submit"},b.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.$el.html(MyGovBar.Templates.search())},b.prototype.submit=function(a){return $("#search_query").val()?MyGovBar.router.go("search/"+$("#search_query").val(),a):void 0},b}(Backbone.View),MyGovBar.Views.SearchResult=function(a){function b(){return this.render=x(this.render,this),k=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.el="#drawer",b.prototype.template=$("#search_result_template").html(),b.prototype.initialize=function(){return this.collection.on("reset",this.render)},b.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.$el.html(MyGovBar.Templates.search_result({query:this.collection.query,results:this.collection.toJSON().splice(0,3)})),MyGovBar.CrossDomain.sendHeight()},b}(Backbone.View),MyGovBar.TagManager=function(){function a(){}return a.prototype.compareItems=function(a,b){return a.get("name")===b.get("name")?!0:!1},a.prototype.init=function(){},a.prototype.filter=function(a,b){return _.filter(a.models,function(a){return this.itemContains(a,b)})},a.prototype.itemContains=function(a){return 0===a.get("name").indexOf(query)},a.prototype.itemToString=function(a){return a.get("name")},a.prototype.stringToItem=function(a){var b;return b=new MyGovBar.Models.Tag,b.set("name",a),b},a}(),MyGovBar.Views.Tags=function(a){function b(){return this.render=x(this.render,this),l=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.el="#drawer",b.prototype.template=$("#tags_template").html(),b.prototype.render=function(){return $("#bar").hasClass("expanded")||MyGovBar.router.expand(),this.$el.html(MyGovBar.Templates.tags({page:this.model.toJSON(),tags:this.model.get("tags").toJSON()})),$("#tag_list").textext({plugins:"tags autocomplete suggestsions ajax",tagsItems:this.model.get("tags").models,itemManager:MyGovBar.TagManager,ajax:{url:MyGovBar.config.api_url+"/tags.json"}}),$("#tag_list").unbind("setSuggestions"),$("#tag_list").on({setSuggestions:function(a,b){var c;return c=[],_.each(b.result,function(a){return c.push(new MyGovBar.Models.Tag(a))}),b.result=c,$("#tag_list").textext()[0].autocomplete().onSetSuggestions(a,b)}}),$("#tag_list").on("setFormData",function(a,b){return MyGovBar.page.get("tags").update(b)})},b}(Backbone.View),a=function(){function a(){this.sendHeight=x(this.sendHeight,this),this.send=x(this.send,this),this.receive=x(this.receive,this);var a,b,d;b=$.deparam.fragment(!0);for(a in b)d=b[a],this.setConfig(a,d);c.receiveMessage(this.receive,MyGovBar.config.parent_url),Backbone.history.on("route",this.sendHeight)}return a.prototype.bar=$("#bar"),a.prototype.hash=document.location.hash,a.prototype.allowed_params=["tabs","url"],a.prototype.receive=function(a){return MyGovBar.router.navigate(a.data,!0)},a.prototype.send=function(a){return c.postMessage(a,MyGovBar.config.parent_url)},a.prototype.sendHeight=function(){return this.send("height-"+this.bar.height()+"px")},a.prototype.setConfig=function(a,b){return-1!==_.indexOf(this.allowed_params,a)?("url"===a&&(a="parent_url"),MyGovBar.config[a]=b):void 0},a}(),MyGovBar.CrossDomain=new a,b=function(a){function b(){return m=b.__super__.constructor.apply(this,arguments)}return w(b,a),b.prototype.routes={hidden:"hide",expanded:"expand",collapsed:"collapse",related:"related",tags:"tags",search:"search","search/:query":"searchResult",feedback:"feedback","*path":"collapse"},b.prototype.initialize=function(){return MyGovBar.page=new MyGovBar.Models.Page,Backbone.history.on("route",this.setCurrent),window.onbeforeunload=function(){sessionStorage.myGovBarExpanded="collapsed"!==Backbone.history.fragment&&"hidden"!==Backbone.history.fragment}},b.prototype.expand=function(){return MyGovBar.CrossDomain.send("expanded"),(new MyGovBar.Views.Expanded).render(),this.setCurrent()},b.prototype.collapse=function(){return MyGovBar.CrossDomain.send("collapsed"),(new MyGovBar.Views.Collapsed).render(),this.setCurrent()},b.prototype.hide=function(){return MyGovBar.CrossDomain.send("hidden"),(new MyGovBar.Views.Hidden).render()},b.prototype.tags=function(){return new MyGovBar.Views.Tags({model:MyGovBar.page}).render()},b.prototype.related=function(){return new MyGovBar.Views.Related({model:MyGovBar.page}).render()},b.prototype.search=function(){return(new MyGovBar.Views.Search).render()},b.prototype.searchResult=function(a){var b;return b=new MyGovBar.Collections.SearchResults({query:a}),b.fetch(),new MyGovBar.Views.SearchResult({collection:b})},b.prototype.feedback=function(){return new MyGovBar.Views.Feedback({model:MyGovBar.page}).render()},b.prototype.setCurrent=function(){var a;return a=Backbone.history.fragment,-1!==a.indexOf("search/")&&(a="search search-result"),$("#tabs li.current").removeClass("current"),$("#tabs li."+a).addClass("current"),$("#bar").removeClass(MyGovBar.config.tabs.join(" ")+" search-result"),$("#bar").addClass(a)},b.prototype.go=function(a,b){return null!=b&&b.preventDefault(),this.navigate(a,{trigger:!0,replace:!0}),!1},b}(Backbone.Router),MyGovBar.router=new b,_.each(MyGovBar.config.tabs,function(a){return $("#tabs ."+a).addClass("activated")}),Backbone.history.start(),$.getJSON("{{ site.api_url }}/ping.js?src=embed&url="+MyGovBar.config.parent_url+"&callback=?"),null!=sessionStorage.myGovBarExpanded&&"true"===sessionStorage.myGovBarExpanded&&MyGovBar.router.navigate("expanded",!0)}.call(this);