// Generated by CoffeeScript 1.4.0
(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},r=function(e,t){return function(){return e.apply(t,arguments)}};window.MyGovBar={el:$("#bar"),Models:{},Collections:{},Routers:{},Views:{}},MyGovBar.Models.Page=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.paramRoot="page",t.prototype.urlRoot="{{ site.api_url }}/pages",t.prototype.url=function(){var e;return e=this.urlRoot,this.id!=null&&(e+="/"+this.id),e+=".json?callback=?",e},t.prototype.lookup=function(){var e,t=this;return e=this.url,this.url=this.urlRoot+"/lookup.json?url="+this.get("url")+"&callback=?",this.fetch({error:function(e,n){if(n.status!==404)return;return t.save()}}),this.url=e},t.prototype.initialize=function(){return this.lookup()},t.prototype.defaults={url:document.referrer},t.prototype.get_meta_keywords=function(){return $("meta[name] ").filter(function(){return this.name.toLowerCase()==="keywords"}).attr("content")},t}(Backbone.Model),MyGovBar.Collections.PagesCollection=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.model=MyGovBar.Models.Page,t.prototype.url="/pages",t}(Backbone.Collection),MyGovBar.Views.Index=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.template=$("#index_template").html(),t.prototype.events={"click #save_tags":"save","click #toggle":"toggle"},t.prototype.render=function(){var e;return e=_.template(this.template),$(this.el).html(e(this.model.toJSON())),this},t.prototype.initialize=function(){return _.bindAll(this,"render"),this.model.bind("change",this.render)},t.prototype.save=function(){return this.model.save({tag_list:$("#tag_list").val()}),!1},t.prototype.fetch=function(){return this.model.fetch()},t.prototype.toggle=function(){return $(this.el).toggleClass("expanded"),$(this.el).toggleClass("minimized"),MyGovBar.CrossDomain.send("toggle")},t}(Backbone.View),e=function(){function e(){this.send=r(this.send,this),this.recieve=r(this.recieve,this),this.parent_url=decodeURIComponent(document.location.hash.replace(/^#/,"")).match(/([^:]+:\/\/.[^/]+)/)[1],XD.receiveMessage(this.recieve,this.parent_url)}return e.prototype.recieve=function(e){switch(e.data){case"shown":case"hidden":return this.toggleVisibility()}},e.prototype.send=function(e){return XD.postMessage(e,this.parent_url)},e.prototype.toggleVisibility=function(){return MyGovBar.el.toggleClass("hidden"),MyGovBar.el.toggleClass("shown")},e}(),MyGovBar.CrossDomain=new e,MyGovBar.url="{{ site.url }}",MyGovBar.api_url="{{ site.api_url }}",new MyGovBar.Views.Index({model:new MyGovBar.Models.Page,el:$("#bar")})}).call(this);